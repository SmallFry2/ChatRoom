<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chatroom (Beta)</title>
    <link rel="stylesheet" href="style.css">
    <style>
        /* Existing styles remain unchanged */
    </style>
</head>

<body>
    <div class="chat-container">
        <div class="chat-header">
            Chatroom (Beta)
        </div>
        <div id="messages" class="chat-body"></div>
        <div class="chat-footer">
            <input type="text" id="messageInput" placeholder="Type a message...">
            <input type="file" id="imageInput" accept="image/*">
            <button id="sendButton">Send</button>
        </div>
    </div>

    <script type="module">
import { initializeApp } from "firebase/app";
import { getAnalytics } from "firebase/analytics";

const firebaseConfig = {
  apiKey: "AIzaSyBNsiTKWGrzCucmP51gs7xSlA4G4Ts1C9M",
  authDomain: "chatroom-fac9d.firebaseapp.com",
  projectId: "chatroom-fac9d",
  storageBucket: "chatroom-fac9d.firebasestorage.app",
  messagingSenderId: "1090098239306",
  appId: "1:1090098239306:web:72469f7641fdb8bcb813b3",
  measurementId: "G-BHCXSQ827F"
};
const app = initializeApp(firebaseConfig);
const analytics = getAnalytics(app);

        const messagesContainer = document.getElementById("messages");
        const messageInput = document.getElementById("messageInput");
        const sendButton = document.getElementById("sendButton");
        const imageInput = document.getElementById("imageInput");
        const banButton = document.getElementById("banButton");

        let username = prompt("What Will Be your name??? :)");
        while (!username || username.trim() === "") {
            username = prompt("Username cannot be empty. Please enter a valid username:");
        }

        let imageUrl = null;
        const bannedUsersRef = ref(database, "bannedUsers");

        function sendMessage() {
            const message = messageInput.value.trim();
            if (message !== "" || imageUrl !== null) {
                const messagesRef = ref(database, "messages");
                const newMessageRef = push(messagesRef);
                set(newMessageRef, {
                    username: username,
                    message: message,
                    timestamp: Date.now(),
                    imageUrl: imageUrl  
                });
                messageInput.value = "";
                imageInput.value = "";
                imageUrl = null;
            }
        }

        const messagesRef = ref(database, "messages");

        onChildAdded(messagesRef, (snapshot) => {
            const messageData = snapshot.val();
            const messageElement = document.createElement("div");
            messageElement.classList.add("message");

            const usernameElement = document.createElement("span");
            usernameElement.classList.add("username");
            usernameElement.textContent = messageData.username;

            const timestampElement = document.createElement("span");
            timestampElement.classList.add("timestamp");
            const messageTimestamp = messageData.timestamp;
            const date = new Date(messageTimestamp);
            timestampElement.textContent = `${date.toLocaleTimeString()}`;

            const messageContent = document.createElement("div");
            messageContent.textContent = messageData.message;

            // Check if the user is banned  
            get(bannedUsersRef).then((snapshot) => {
                const bannedUsers = snapshot.val() || {};
                if (bannedUsers[messageData.username]) {
                    return; // Don't display messages from banned users  
                }

                messageElement.appendChild(usernameElement);
                messageElement.appendChild(messageContent);
                messageElement.appendChild(timestampElement);

                if (messageData.imageUrl) {
                    const imgElement = document.createElement("img");
                    imgElement.src = messageData.imageUrl;
                    imgElement.classList.add("message-image");
                    messageElement.appendChild(imgElement);
                }

                // Set message alignment  
                if (messageData.username === username) {
                    messageElement.classList.add("right");
                } else {
                    messageElement.classList.add("left");
                }

                messagesContainer.appendChild(messageElement);
                messagesContainer.scrollTop = messagesContainer.scrollHeight;
            });
        });

        messageInput.addEventListener("keydown", (event) => {
            if (event.key === "Enter") {
                sendMessage();
            }
        });

        sendButton.addEventListener("click", sendMessage);

        clearButton.addEventListener("click", () => {
            if (confirm("Are you sure you want to clear your messages? This action cannot be undone.")) {
                const messagesRef = ref(database, "messages");
                get(messagesRef).then((snapshot) => {
                    snapshot.forEach((childSnapshot) => {
                        const messageData = childSnapshot.val();
                            remove(ref(database, `messages/${childSnapshot.key}`));
                            window.location.reload();
                        
                    });
                });
                messagesContainer.innerHTML = ""; 
            }
        });

        imageInput.addEventListener("change", () => {
            const file = imageInput.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function (e) {
                    imageUrl = e.target.result;
                };
                reader.readAsDataURL(file);
            }
        });

        // Event listener for Ban List button  
        banButton.addEventListener("click", () => {
            const userToBan = prompt("Enter the username to ban:");
            if (userToBan) {
                const bannedUsersRef = ref(database, "bannedUsers/" + userToBan);
                set(bannedUsersRef, true).then(() => {
                    alert(`${userToBan} has been banned.`);
                });
            }
        });
    </script>
</body>

</html>
